generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  ADMIN
  CUSTOMER_SERVICE
  TRANSACTIONS
  OPERATIONS
  MERCHANT
}

model Permission {
  id          String        @id @default(uuid())
  name        String        @unique
  description String?
  roles       RolePermission[]
}

model RolePermission {
  id           String     @id @default(uuid())
  role         Role
  permissionId String
  permission   Permission @relation(fields: [permissionId], references: [id])

  @@unique([role, permissionId])
}

model User {
  id           String       @id @default(uuid())
  fullName     String
  userName     String       @unique
  password     String
  isEnabled    Boolean      @default(true)
  tg_handle    String?
  tg_id        String?
  last_login   DateTime?
  last_logout  DateTime?
  role         Role
  code         String?      // Add a field to store the merchant code
  accessTokens AccessToken[]

  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt

  @@index([role]) // Add an index on role for better query performance
}

model AccessToken {
  id          String     @id @default(uuid())
  accessToken String
  user        User       @relation(fields: [userId], references: [id])
  userId      String
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
}

model Merchant {
  id                String     @id @default(uuid())
  code              String
  parent_id         Int?
  payin_theme       String?
  notes             String?
  site_url          String
  api_key           String
  secret_key        String
  notify_url        String
  return_url        String
  min_payin         String
  max_payin         String
  payin_commission  Decimal
  min_payout        String
  max_payout        String
  payout_commission Decimal
  payout_notify_url String
  balance           String
  is_test_mode      Boolean    @default(false)
  is_enabled        Boolean    @default(true)
  is_demo           Boolean    @default(false)
  createdAt         DateTime   @default(now())
  updatedAt         DateTime   @updatedAt
}
